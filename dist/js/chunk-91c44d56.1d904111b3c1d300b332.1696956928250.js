(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-91c44d56"],{"232d":function(t,e,a){t.exports=a.p+"img/no-data.eca1736d.png"},"8c12":function(t,e,a){"use strict";a("e06b")},e06b:function(t,e,a){},f555:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"visitorPage"},[e("div",{staticClass:"title"},[e("h3",[t._v(t._s(t.visitorName)+"提交的访客审批")]),e("p",[t._v(t._s(t.approveStr))])]),e("div",{staticClass:"content"},[e("List",[e("ListItem",[e("span",[t._v("流水号")]),e("p",[t._v(t._s(t.flowNo))])]),e("ListItem",[e("span",[t._v("访问时间")]),e("p",[t._v(t._s(t.visitTime))])]),e("ListItem",[e("span",[t._v("被访人")]),e("p",[t._v(t._s(t.teacherName))])]),e("ListItem",[e("span",[t._v("来访目的")]),e("p",[t._v(t._s(t.visitReason))])]),e("ListItem",[e("span",[t._v("同行人员")]),e("p",t._l(t.visitorRecordList,(function(a,n){return e("Tag",{key:n},[t._v(t._s(a))])})),1)]),e("ListItem",[e("span",[t._v("登记人")]),e("p",[t._v(t._s(t.visitorName))])]),e("ListItem",[e("span",[t._v("班主任")]),e("p",[t._v(t._s(t.teacherName))])]),e("ListItem",[e("span",[t._v("身份")]),e("p",[t._v("家长")])])],1)],1),e("div",{staticClass:"cardStep"},[e("h3",[t._v("审批流程")]),e("Timeline",t._l(t.spList,(function(a,n){return e("TimelineItem",{key:n,scopedSlots:t._u([{key:"dot",fn:function(){return[e("span",{staticClass:"name"},[t._v(t._s(0==n?"家":a.refPersonName.charAt(0)))])]},proxy:!0}],null,!0)},[e("div",[e("p",{staticClass:"doThing"},[e("span",[t._v(t._s(a.optPersonTypeStr))]),e("span",{staticClass:"time"},[t._v(t._s(a.createTime))])]),e("p",{staticClass:"namedetail"},[t._v(" "+t._s(""!=a.approveStr&&null!=a.approveStr||0!=n?a.refPersonName:"家长")+" "+t._s(""==a.approveStr||null==a.approveStr?" ":"("+a.approveStr+")")+" ")])])])})),1)],1),1==t.roleId&&1==t.agreeStat?e("Button",{staticClass:"cancel",attrs:{type:"primary",disabled:1!=t.agreeStat},on:{click:function(e){return t.handleCancel()}}},[t._v("撤回")]):t._e(),2==t.roleId&&1==t.agreeStat?e("div",{staticClass:"spDom"},[e("Button",{staticClass:"aggreeBtn",attrs:{type:"primary"},on:{click:function(e){return t.aggreeBtn(1)}}},[t._v("同意")]),e("Button",{staticClass:"rejectBtn",attrs:{type:"success",ghost:""},on:{click:function(e){return t.aggreeBtn(2)}}},[t._v("驳回")])],1):t._e()],1)},s=[],o=a("ade3"),i=(a("a9e3"),a("14d9"),a("ac1f"),a("5319"),a("b1d0")),r=a("1271"),c=a("3b2d"),d=(a("232d"),{name:"index",data:function(){var t;return t={title:"详情",visitorName:"",eventId:"",studentId:"",optPhone:"",roleId:"",spList:[],agreeStat:"",flowNo:"",teacherName:"",visitReason:"",visitorRecordList:[]},Object(o["a"])(t,"visitorName",""),Object(o["a"])(t,"sfzType",""),Object(o["a"])(t,"visitTime",""),Object(o["a"])(t,"eventStatus",""),t},created:function(){document.title=this.title,this.eventId=c["a"].getQueryVariable("eventId"),this.studentId=Number(c["a"].getQueryVariable("studentId")),this.optPhone=Number(c["a"].getQueryVariable("optPhone")),this.roleId=c["a"].getQueryVariable("roleType"),this.getDetailFun()},activated:function(){document.title=this.title},mounted:function(){},methods:{handleAdd:function(){this.$router.push({path:"guestadd",query:{studentId:this.studentId,optPhone:this.optPhone,roleId:this.roleId}})},getDetailFun:function(){var t=this;Object(i["a"])({method:"get",url:r["a"].recordUrl.findDetail+"?studentId="+Number(this.studentId)+"&eventId="+Number(this.eventId),data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){if(console.log("res",e),200==e.code){console.log("返回数据",e),t.spList=e.data.eventHistory,t.visitorName=e.data.event.visitorName,t.approveStr=e.data.event.approveStr,t.flowNo=e.data.event.flowNo,t.visitTime=e.data.event.startTime,t.teacherName=e.data.event.teacherName,t.visitReason=e.data.event.visitReason;for(var a=e.data.visitorRecordList,n=0;n<a.length;n++)t.visitorRecordList.push(a[n].visitName);t.visitorName=e.data.event.visitorName,t.sfzType=e.data.event.visitorIdentity,t.agreeStat="未审批"==e.data.event.approveStr?1:"同意"==e.data.event.approveStr?2:"拒绝"==e.data.event.approveStr?3:"",t.eventStatus=e.data.event.eventStatus,console.log("agreeStat",t.agreeStat)}else t.$Message.info(e.msg)})).catch((function(t){console.log(t)}))},handleCancel:function(){var t=this;Object(i["a"])({method:"post",url:r["a"].recordUrl.visiteventRollback,data:{eventId:Number(this.eventId),optPhone:Number(this.optPhone)},headers:{"Content-Type":"application/json"}}).then((function(e){console.log("res",e),200==e.code?(console.log("返回数据",e),t.$Message.info(e.msg),setTimeout((function(){t.$router.go(-1)}),1500)):t.$Message.info(e.msg)})).catch((function(t){console.log(t)}))},aggreeBtn:function(t){var e=this;Object(i["a"])({method:"post",url:r["a"].recordUrl.visitApprove,data:{eventId:Number(this.eventId),recStatus:t},headers:{"Content-Type":"application/json"}}).then((function(t){console.log("res",t),200==t.code?(console.log("返回数据",t),e.$Message.info(t.msg),setTimeout((function(){void 0==e.roleId&&(e.roleId=c["a"].getQueryVariable("roleType")),void 0==e.token&&(e.token=c["a"].getQueryVariable("openId"));var t=window.location.protocol+"//"+window.location.hostname+"/event/index.html#/guestIndex?roleType="+e.roleId+"&studentId="+e.studentId+"&openId="+e.token+"&phone="+e.optPhone;console.log("url",t),location.replace(t)}),1500)):e.$Message.info(t.msg)})).catch((function(t){console.log(t)}))}}}),l=d,v=(a("8c12"),a("2877")),p=Object(v["a"])(l,n,s,!1,null,"69717d66",null);e["default"]=p.exports}}]);